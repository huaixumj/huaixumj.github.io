(window.webpackJsonp=window.webpackJsonp||[]).push([[372],{757:function(t,s,a){"use strict";a.r(s);var n=a(1),p=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("App的安装包都可以解压。前端资源，一般都是明文存放在安装包中，为防止解压后泄露敏感信息，需要进行安全处理。")]),t._v(" "),s("p",[t._v("由此DCloud提供了App端的js/nvue文件的原生混淆。5+ App/Wap2App支持对指定的js进行原生混淆。uni-app支持对指定的nvue文件原生混淆。")]),t._v(" "),s("p",[t._v("原生混淆后的安装包，解压后看到的都是乱码。")]),t._v(" "),s("p",[t._v("但需要注意：")]),t._v(" "),s("ol",[s("li",[t._v("没有绝对的安全，非常重要的信息，应该保存在服务器而不是前端")]),t._v(" "),s("li",[t._v("运行期对资源代码解密是影响执行性能的。不建议全包混淆，仅挑选需要保护的个别文件处理即可")]),t._v(" "),s("li",[t._v("uni-app项目制作wgt包不支持原生混淆加密（即使配置也不会生效），HBuilderX3.1.0+版本后支持")]),t._v(" "),s("li",[t._v("为了保证加密数据的安全性，加密算法和key不对外公开，因此离线打包无法支持原生混淆加密，标准基座或自定义基座真机运行也不支持原生混淆加密（只有正式云打包才支持）")])]),t._v(" "),s("p",[t._v("具体使用方式如下：")]),t._v(" "),s("h3",{attrs:{id:"配置要混淆的js-nvue文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置要混淆的js-nvue文件"}},[t._v("#")]),t._v(" 配置要混淆的js/nvue文件")]),t._v(" "),s("p",[t._v("打开manifest.json文件，切换到“源码视图”，按不同项目类型进行配置。")]),t._v(" "),s("h4",{attrs:{id:"uni-app项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uni-app项目"}},[t._v("#")]),t._v(" uni-app项目")]),t._v(" "),s("p",[t._v("uni-app的js运行在独立的jscore中，而不是webview中，所以不受iOS平台WKWebview不支持原生混淆的限制。\nuni-app的vue页面中的js，是整体编译到一个大js文件中的，它经过编译，已经不再是vue源码了，但还不是乱码。对这个统一的大文件进行混淆会有影响性能。\n所以uni-app只支持独立混淆nvue/js文件。")]),t._v(" "),s("ul",[s("li",[t._v("vue页面\nHBuilderX2.6.3+版本"),s("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36599",target:"_blank",rel:"noopener noreferrer"}},[t._v("v3编译器"),s("OutboundLink")],1),t._v("支持对独立的js文件进行原生混淆，开发者可以将要保护的js代码写到独立的js文件中，在vue页面中使用import引用；如果此js同时被nvue页面import引用，则nvue页面也需要配置原生混淆才有效。另外main.js也可以原生混淆。\n老版本不支持vue页面的原生混淆，开发者只能将要保护的js代码写到nvue文件中进行保护。")]),t._v(" "),s("li",[t._v("nvue页面\nHBuilderX2.3.4+版本支持nvue文件的原生混淆。\n如果nvue页面引入了外部的js文件，会被一起原生混淆。但如果这个js还被其他不加密的文件引用，则该js仍然会暴露在安装包中。")]),t._v(" "),s("li",[t._v("vue页面和nvue页面同时使用加密js里的数据或方法（HBuilderX2.6.3+版本v3编译器）\n配置该js加密，并在App.vue中引用该js，把该js中的数据或方法赋值给全局对象，如globalData，vue和nvue中通过访问getApp访问共享数据或方法即可，无需配置nvue页面加密。")])]),t._v(" "),s("p",[t._v("如果要发布多端的话，要保护的js最好写在app-plus的条件编译中，否则发布到其他端，还是无法原生混淆。")]),t._v(" "),s("p",[s("strong",[t._v("HBuilderX2.3.4版本开始，uni-app项目支持对nvue文件进行原生混淆")])]),t._v(" "),s("p",[t._v('在"app-plus" -> "confusion" -> "resources"节点下添加要混淆的nvue文件列表：')]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"app-plus"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"confusion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NVUE原生混淆"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"pages/barcode/barcode.nvue"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"pages/map/map.nvue"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...  ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("resource下的键名为nvue文件路径（相对于应用根目录），值为空JSON对象（大括号）。")]),t._v(" "),s("a",{attrs:{id:"vuejs"}}),t._v(" "),s("p",[s("strong",[t._v("HBuilderX2.6.3+版本开始，uni-app项目使用"),s("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36599",target:"_blank",rel:"noopener noreferrer"}},[t._v("v3编译器"),s("OutboundLink")],1),t._v("支持对vue页面中引用的js文件进行原生混淆")])]),t._v(" "),s("p",[t._v("在manifest.json文件中添加要混淆的js文件列表：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"app-plus"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"confusion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"原生混淆"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"common/test.js"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...  ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在vue文件中引用混淆的js文件：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("import test from '../common/test.js';\n//test.join();  //调用引用js中的方法\n")])])]),s("p",[s("strong",[t._v("注意：uni-app中vue页面的webview组件支持加载使用加密混淆hybrid、static目录中的js文件，nvue页面的webview组件不支持。")])]),t._v(" "),s("h4",{attrs:{id:"_5-app-wap2app项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-app-wap2app项目"}},[t._v("#")]),t._v(" 5+ App/Wap2App项目")]),t._v(" "),s("p",[t._v('应用运行期间在页面打开时需要消耗更多时间进行混淆文件还原，为减少对运行速度的影响，5+App/wap2app仅支持对js文件进行原生混淆。\n在"plus" -> "confusion" -> "resources"节点下添加要混淆的js文件列表：')]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"plus"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"confusion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JS原生混淆"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"js/common.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"js/immersed.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...  ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("resource下的键名为js文件路径（相对于应用根目录），值为空JSON对象（大括号）。")]),t._v(" "),s("p",[s("a",{attrs:{id:"wkwebview"}}),t._v(" "),s("strong",[t._v("HBuilderX2.6.11+版本开始，在iOS11+设备上使用WKWebview也可以支持JS原生混淆")]),t._v("\nWKWebview使用了更加严格的安全机制，使用原生混淆的js文件在html页面中必须使用自定义协议头plus-confusion://来引用：")]),t._v(" "),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/javascript"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("plus-confusion://../js/common.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- plus-confusion://后面为js文件路径，相对于当前html页面的路径 --\x3e")]),t._v("\n")])])]),s("p",[t._v('在manifest.json的"plus" -> "confusion" -> "resources"节点下添加要混淆的js文件列表。\n在"confusion"节点下添加 "supportWKWebview": true 支持WKWebview。\n由于自定义协议仅在iOS11及以上设备才支持，建议配置应用支持的最低版本'),s("a",{attrs:{href:"https://ask.dcloud.net.cn/article/94#deploymentTarget",target:"_blank",rel:"noopener noreferrer"}},[t._v("deploymentTarget"),s("OutboundLink")],1),t._v("为11.0：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"plus"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"confusion"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JS原生混淆"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"supportWKWebview"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"resources"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"js/common.js"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   \n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"distribute"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apple"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"deploymentTarget"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"11.0"')]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置应用仅支持iOS11及以上设备")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...  ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注意：iOS平台WKWebview需iOS11+系统才支持原生混淆。5+App/wap2app项目，如果要兼容iOS11以下设备只能强制使用UIWebview内核，但苹果将要废弃UIWebview（"),s("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36348",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情"),s("OutboundLink")],1),t._v("）。如对原生混淆很重视，从长远考虑，建议改造升级uni-app")])]),t._v(" "),s("h3",{attrs:{id:"提交云端打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#提交云端打包"}},[t._v("#")]),t._v(" 提交云端打包")]),t._v(" "),s("p",[t._v("配置好原生混淆的文件列表后，需要提交云端打包，"),s("strong",[t._v("注意在App云端打包对话框中需要勾选“对配置的js文件进行原生混淆”")]),t._v(" "),s("img",{attrs:{src:"https://native-res.dcloud.net.cn/images/uniapp/security/confusion.png",alt:""}})]),t._v(" "),s("p",[s("strong",[t._v("再次强调：为了保证加密数据的安全性，加密算法和key不对外公开，因此离线打包无法支持原生混淆。")]),t._v("\n熟悉原生的开发者可将敏感信息存放于原生代码中，再与js进行交互。")]),t._v(" "),s("p",[t._v("对安全性要求较高的开发者，除了对前端js进行加密外，还应该对整个apk再进行一次加固。推荐"),s("RouterLink",{attrs:{to:"/tutorial/app-security.html"}},[t._v("uni安全加固")]),t._v("，目前由蚂蚁小程序云提供支持，可有效提升应用整体安全性。")],1)])}),[],!1,null,null,null);s.default=p.exports}}]);