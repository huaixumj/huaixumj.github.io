(window.webpackJsonp=window.webpackJsonp||[]).push([[522],{903:function(t,s,n){"use strict";n.r(s);var a=n(1),e=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),s("p",[t._v("本文为"),s("code",[t._v("uni-push 2.0")]),t._v("（需要HBuilderX 3.5.1 及其以上版本支持）的介绍，如果旧项目需要使用老版本的"),s("code",[t._v("uni-push 1.0")]),t._v("，另见："),s("RouterLink",{attrs:{to:"/unipush-v1.html"}},[t._v("uni-push 1.0")])],1)]),t._v(" "),s("h2",{attrs:{id:"uni-push介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uni-push介绍"}},[t._v("#")]),t._v(" uni-push介绍")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/unipush.html"}},[t._v("查看uni-push介绍")])],1),t._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[s("code",[t._v("uni-push 2.0")]),t._v("是DCloud推出的、全端的、云端一体的统一推送服务。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("客户端方面，"),s("code",[t._v("uni-push 2.0")]),t._v("支持App、web、小程序。")]),t._v(" "),s("ul",[s("li",[t._v("App端，内置了苹果、华为、小米、OPPO、VIVO、魅族、谷歌FCM等手机厂商的系统推送和个推第三方推送")]),t._v(" "),s("li",[t._v("小程序端，内置了socket在线推送。如需模板消息/订阅消息，另见"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/uni-subscribemsg.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-subscribemsg"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("web端，内置了socket在线推送\n（uni-push1仅支持app，且app必须包含个推原生sdk。uni-push2在app端如不需要厂商推送，只需在线推送，无需集成个推原生sdk）")])])]),t._v(" "),s("li",[s("p",[t._v("服务端方面，"),s("code",[t._v("uni-push 2.0")]),t._v("支持uniCloud云端一体，无需再编写复杂代码轻松完成push。\n（uni-push1.0仅支持使用传统服务器开发语言如php，未和客户端有效协同，流程比uni-push2.0繁琐）")])]),t._v(" "),s("li",[s("p",[t._v("uni-push还自带一个web控制台。不写代码也可以在web页面发推送。uni-push1.0的web控制台在"),s("a",{attrs:{href:"https://dev.dcloud.net.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("dev.dcloud.net.cn"),s("OutboundLink")],1),t._v("。uni-push2.0的web控制台是开源的，属于uni-admin插件"),s("a",{attrs:{href:"https://ext.dcloud.net.cn/plugin?name=uni-push-admin",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("如果你的项目由于特殊原因不能通过uniCloud的云函数使用uni-push2.0，你希望直接通过调用个推服务器推送消息。在这种情况下：")]),t._v(" "),s("ul",[s("li",[t._v("uni-app项目，需要使用老版的 "),s("RouterLink",{attrs:{to:"/unipush-v1.html"}},[t._v("uni-push1.0")]),t._v(" 。相关密钥获取方式：登录"),s("a",{attrs:{href:"https://dev.dcloud.net.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("开发者中心"),s("OutboundLink")],1),t._v("左侧菜单->"),s("code",[t._v("uni-push")]),t._v("->"),s("code",[t._v("uni-push 2.0（支持全端推送）")]),t._v("->"),s("code",[t._v("消息推送")]),t._v("->"),s("code",[t._v("应用配置")]),t._v("->"),s("code",[t._v("应用信息")])],1),t._v(" "),s("li",[t._v("uni-app-x 项目，虽然只能使用 uni-push2.0，但支持在"),s("a",{attrs:{href:"https://dev.dcloud.net.cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("开发者中心"),s("OutboundLink")],1),t._v("左侧菜单-"),s("code",[t._v("uni-push")]),t._v("->"),s("code",[t._v("uni-push 2.0（支持全端推送）")]),t._v("-> "),s("code",[t._v("厂商推送设置")]),t._v(" 在顶端注意事项中，点击获取个推的MasterSecret")])])])]),t._v(" "),s("p",[t._v("请注意，直接调用个推服务器进行推送可能需要更多的配置和操作步骤，具体请参考"),s("RouterLink",{attrs:{to:"/unipush-v1.html#request-getui"}},[t._v("调用个推服务器")]),t._v("的相关文档。")],1),t._v(" "),s("h2",{attrs:{id:"为什么选择uni-push-2-0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么选择uni-push-2-0"}},[t._v("#")]),t._v(" 为什么选择"),s("code",[t._v("uni-push 2.0")])]),t._v(" "),s("p",[t._v("由于手机厂商众多，他们各自都有不同的推送服务，包括Apple、google（仅能在海外使用）、华为、小米、oppo、vivo、魅族，以及还有一些没有专业推送服务的中小手机品牌。他们对App后台耗电都有查杀机制，除了微信等大应用，普通应用很难常驻后台。")]),t._v(" "),s("p",[t._v("如果开发者把上述每个平台的客户端和服务器的SDK都对接一遍，还自己处理没有push服务的中小品牌手机，那过于困难了。所以业内有专业的推送服务厂商把各种手机厂商的通道封装成一套统一的API，如个推（属于上市公司每日互动）；同时这些三方专业推送厂商还提供了高速socket通道。当应用在线时，也可以直接通过socket下发消息。否则开发者需要写很多判断代码、搭建socket服务器、处理在线时和离线时各种差异。")]),t._v(" "),s("p",[t._v("DCloud与个推（A股上市公司每日互动）深度合作，为uni-app的开发者提供了比传统方案便利甚多的统一推送方案"),s("code",[t._v("uni-push 2.0")]),t._v("，利用云端一体的优势，同时提供基于uniCloud的push服务器和基于uni-app的push客户端，两者高效协同，极大的简化了push的使用。")]),t._v(" "),s("blockquote",[s("p",[t._v("注："),s("code",[t._v("uni-push")]),t._v("的服务器稳定性是由阿里云serverless、腾讯云serverless、个推来保障的，都是日活过亿的上市公司，无需顾虑稳定性。")])]),t._v(" "),s("p",[t._v("如下图所示：\n首先开发者的uniCloud应用服务器向uni-push服务器发送push消息，然后")]),t._v(" "),s("ul",[s("li",[t._v("如果客户端应用在线，客户端通过socket直接收到push在线消息；")]),t._v(" "),s("li",[t._v("客户端应用不联网时，"),s("code",[t._v("uni-push")]),t._v("服务器根据客户端类型，把push消息发给某个手机厂商的push服务器或小程序的订阅消息服务器；然后厂商push通道会把这条消息发到手机的通知栏或微信的订阅消息里；手机用户点击通知栏消息或小程序订阅消息后，启动App或小程序，客户端才能收到离线消息。\n"),s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/cd3e676a-6a3b-44ea-9045-5bc058d0d8ae.png",alt:"img",width:"100%",loading:"lazy"}})])]),t._v(" "),s("p",[t._v("总结下"),s("code",[t._v("uni-push")]),t._v("提供的功能：")]),t._v(" "),s("ol",[s("li",[t._v("一个在线的socket下行服务，无论app、小程序、web，只要在线，都可以从服务器推送消息。尤其对于uniCloud用户，这个免费socket下行服务用途很多。")]),t._v(" "),s("li",[t._v("app平台，提供app离线时的推送，聚合了所有已知手机厂商的push通道；对于未提供push通道的小手机厂商，提供后台常驻进程接收push消息（受手机rom节电设置约束）")]),t._v(" "),s("li",[t._v("小程序平台，目前提供了下行socket通道，后续会整合小程序离线时的订阅消息")]),t._v(" "),s("li",[t._v("web平台，目前提供了下行socket通道，后续会提供webnotification的封装。当标签卡在后台时（注意不是关闭时），仍然可以在屏幕上弹出通知栏。")]),t._v(" "),s("li",[t._v("快应用平台，目前提供了下行socket通道，后续会提供离线push的封装")]),t._v(" "),s("li",[t._v("一个"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/admin",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-admin"),s("OutboundLink")],1),t._v("插件，开源的web控制台，无需编程，可视化界面发送push消息 "),s("a",{attrs:{href:"https://ext.dcloud.net.cn/plugin?name=uni-push-admin",target:"_blank",rel:"noopener noreferrer"}},[t._v("详见"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("在"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/uni-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-starter"),s("OutboundLink")],1),t._v("里，还提供了app push权限判断、申请、开关设置，搭配使用可以大量降低开发工作量。")]),t._v(" "),s("p",[t._v("注意：app申请创建通知栏消息、web申请弹出通知，均会由操作系统或浏览器自动弹窗询问用户是否同意。小程序下需要手机用户主动发起订阅行为，才能送达消息。")]),t._v(" "),s("p",[s("code",[t._v("uni-push")]),t._v("即降低了开发成本，又提高了push送达率，还支持全平台，并且免费，是当前推送的最佳解决方案。")]),t._v(" "),s("h2",{attrs:{id:"cost"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cost"}},[t._v("#")]),t._v(" uni-push 2.0 使用uniCloud产生的费用说明")]),t._v(" "),s("p",[s("code",[t._v("uni-push 2.0")]),t._v("本身并不收费，实际使用中需要依赖uniCloud云服务，而uniCloud价格很实惠：")]),t._v(" "),s("ul",[s("li",[t._v("调用10000次云函数仅需0.0133元")]),t._v(" "),s("li",[t._v("调用10000次数据库查询仅需0.015元")])]),t._v(" "),s("p",[t._v("可见价格之低，几乎可以忽略不计。")]),t._v(" "),s("p",[t._v("一次消息推送 = 1次云函数请求 + 最高3次数据库查询（最常用的基于user_id推送仅需一次查询，详情参考："),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/uni-cloud-push/mate.html#%E6%8E%A8%E9%80%81%E6%8E%A5%E5%8F%A3%E6%9F%A5%E5%BA%93%E8%AF%A6%E8%A7%A3",target:"_blank",rel:"noopener noreferrer"}},[t._v("推送接口查库详解"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("即：最高(1 * 0.0133 + 3 * 0.015)/10000 = 0.00000583元/每次（注：给你的应用的所有注册用户群发消息算一次）")]),t._v(" "),s("p",[t._v("详细的计费参考："),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/price.html#aliyun-postpay",target:"_blank",rel:"noopener noreferrer"}},[t._v("阿里云版uniCloud按量计费文档"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"start"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#start"}},[t._v("#")]),t._v(" 快速上手")]),t._v(" "),s("h3",{attrs:{id:"第一步-开通"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第一步-开通"}},[t._v("#")]),t._v(" 第一步：开通")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/uni-push/open.html"}},[t._v("查看开通文档")])],1),t._v(" "),s("h3",{attrs:{id:"第二步-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第二步-配置"}},[t._v("#")]),t._v(" 第二步：配置")]),t._v(" "),s("ul",[s("li",[t._v("iOS 平台如需要使用推送功能，还需要上传专用的推送证书")]),t._v(" "),s("li",[t._v("Android 平台如需要使用离线推送，需要配置APP手机厂商推送参数（可选，应用进程离线时推送通道）")])]),t._v(" "),s("p",[t._v("以上配置，详见："),s("RouterLink",{attrs:{to:"/uni-push/open.html#other-config"}},[t._v("uni-push其它配置")])],1),t._v(" "),s("h3",{attrs:{id:"第三步-客户端操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第三步-客户端操作"}},[t._v("#")]),t._v(" 第三步：客户端操作")]),t._v(" "),s("h4",{attrs:{id:"名词解释"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#名词解释"}},[t._v("#")]),t._v(" 名词解释")]),t._v(" "),s("h5",{attrs:{id:"offline"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#offline"}},[t._v("#")]),t._v(" 离线推送")]),t._v(" "),s("img",{staticStyle:{"margin-left":"20px","margin-top":"0",float:"right"},attrs:{width:"30%",src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/20220325203150.jpg",loading:"lazy"}}),t._v(" "),s("p",[t._v("仅APP端支持，当应用被用户关闭，或者运行到后台时，手机厂商为了省电或释放内存，会终止App后台联网。")]),t._v(" "),s("p",[t._v("消息将通过不会离线的手机厂商通道，下发到手机系统推送服务模块；")]),t._v(" "),s("p",[t._v("此时客户端会自动创建通知栏消息，展示在系统消息中心（如图所示）但客户端监听不到消息内容；当用户点击通知栏消息后，会将APP唤醒此时APP才能监听到消息内容。")]),t._v(" "),s("h5",{attrs:{id:"online"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#online"}},[t._v("#")]),t._v(" 在线推送")]),t._v(" "),s("p",[t._v("当应用在线时，不会创建“通知栏消息”，此时客户端会立即监听到消息内容。")]),t._v(" "),s("p",[t._v("如果你希望当应用在线时，也通过“通知栏消息”来提醒用户；可以通过以下两种方式实现：")]),t._v(" "),s("ol",[s("li",[t._v("监听到消息内容后，根据业务需要自己判断是否要创建“通知栏消息”，需要就调用创建本地消息API "),s("code",[t._v("uni.createPushMessage")]),t._v("(uni-app 框架"),s("a",{attrs:{href:"https://uniapp.dcloud.io/api/plugins/push.html#createpushmessage",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1),t._v("，uni-app x 框架"),s("a",{attrs:{href:"https://uniapp.dcloud.io/uni-app-x/api/push.html#createpushmessage",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1),t._v(") 手动创建通知栏消息。")]),t._v(" "),s("li",[t._v("服务端执行推送时，传递参数"),s("code",[t._v("force_notification:true")]),t._v("，客户端就会自动创建“通知栏消息”（此时你监听不到消息内容），当用户点击通知栏消息后，APP才能监听到消息内容。")])]),t._v(" "),s("p",[t._v("以上两种方案各有优劣，方案一更加灵活；比如：客服功能，客户端接收到聊天消息时，应用如果已经打开聊天对话页面，就直接将监听到的推送内容，渲染到页面。如果应用未打开聊天页，则调用api创建“通知栏消息”提醒用户；此时你还可以执行一些其他逻辑，比如将tabBar的消息中心加红点等。方案二比较简便，客户端无需额外编写代码，自动创建通知栏消息；但仅适用于不关心客户端行为就创建“通知栏消息”的场景，如广告营销内容的推送等。")]),t._v(" "),s("h5",{attrs:{id:"getuiphonetype"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#getuiphonetype"}},[t._v("#")]),t._v(" 客户端类型")]),t._v(" "),s("p",[t._v("个推的客户端类型是仅根据使用的sdk类型来判断的，分为两类：")]),t._v(" "),s("ol",[s("li",[t._v("native sdk（在"),s("code",[t._v("manifest.json")]),t._v("->"),s("code",[t._v("APP 模块配置")]),t._v("->"),s("code",[t._v("uniPush 2.0")]),t._v("配置界面勾选离线推送时启用的 sdk），获取到的 cid 的 phoneType 为 APP 类型。")]),t._v(" "),s("li",[t._v("jssdk（"),s("code",[t._v("manifest.json")]),t._v("->"),s("code",[t._v("APP 模块配置")]),t._v("->"),s("code",[t._v("uniPush 2.0")]),t._v("配置界面，仅勾选在线推送，未勾选离线推送时启用的 sdk），获取到的 cid 的 phoneType 均为小程序，而不管实际上你的客户端是 APP、小程序还是 web。")])]),t._v(" "),s("h4",{attrs:{id:"客户端启用uni-push2-0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端启用uni-push2-0"}},[t._v("#")]),t._v(" 客户端启用uni-push2.0")]),t._v(" "),s("h5",{attrs:{id:"enable-x-app"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enable-x-app"}},[t._v("#")]),t._v(" uni-app x 框架的App端")]),t._v(" "),s("p",[t._v("标准基座不包含uni-push模块，如果需要使用此模块，应当在提交云打包时，项目代码中包含uni-push相关客户端api。"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uni-app-x/collocation/manifest-modules.html#treeshaking",target:"_blank",rel:"noopener noreferrer"}},[t._v("点此"),s("OutboundLink")],1),t._v("了解uni-app x的摇树机制")]),t._v(" "),s("p",[t._v("所以在开发调试时，需要先写一段包含uni-push相关客户端api代码，再打一个自定义基座。")]),t._v(" "),s("p",[t._v("例如：")]),t._v(" "),s("ol",[s("li",[t._v("先添加如下代码：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("uni"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPushClientId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("注意：此时由于运行的标准基座中，不包含uni-push模块，如果运行会报错，不用着急继续往下操作")])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("点击菜单栏的【发行】-【原生APP-云打包】然后再弹出的窗口中勾选【制作自定义调试基座】- 点击【打包】")]),t._v(" "),s("li",[t._v("打包成功后，点击菜单栏的【运行】-【运行到手机或模拟器】-【运行到 Android App 基座】然后再弹出的窗口中勾选【使用自定义基座运行】-【运行】")])]),t._v(" "),s("p",[t._v("接下来即可使用 uni-push 相关客户端 api")]),t._v(" "),s("h5",{attrs:{id:"enable-app"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#enable-app"}},[t._v("#")]),t._v(" uni-app 框架App端")]),t._v(" "),s("p",[t._v("操作步骤打开"),s("code",[t._v("manifest.json")]),t._v(" - "),s("code",[t._v("App模块配置")]),t._v(" - 中勾选"),s("code",[t._v("uni-push 2.0")]),t._v(" - "),s("code",[t._v("重新编译项目")]),t._v(" "),s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/20220525105852.jpg",alt:"",loading:"lazy"}})]),t._v(" "),s("h5",{attrs:{id:"h5端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#h5端"}},[t._v("#")]),t._v(" h5端")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/20220525105914.jpg",alt:"",loading:"lazy"}})]),t._v(" "),s("h5",{attrs:{id:"微信小程序端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序端"}},[t._v("#")]),t._v(" 微信小程序端")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/87accaa0-e6a4-4916-9a74-87719142abaa.jpg",alt:"",loading:"lazy"}})]),t._v(" "),s("p",[t._v("其他小程序启用方式参考微信小程序，这里不一一列举")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("manifest.json")]),t._v("中配置完之后，需要重新编译项目，即：点击如图"),s("code",[t._v("重新运行")]),t._v("按钮")]),t._v(" "),s("img",{staticStyle:{"max-width":"260px"},attrs:{width:"50%",src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/WechatIMG589.jpeg",loading:"lazy"}}),t._v(" "),s("h5",{attrs:{id:"useinmp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#useinmp"}},[t._v("#")]),t._v(" 小程序中使用uni-push2.0的白名单配置")]),t._v(" "),s("p",[t._v("uni-push在web和小程序端就是个websocket；各家小程序平台，均要求在小程序管理后台配置小程序应用的联网服务器域名，否则无法联网。")]),t._v(" "),s("p",[t._v("根据下表，在小程序管理后台设置socket合法域名。下表的域名均为个推自有域名，并非DCloud所属域名。")]),t._v(" "),s("ul",[s("li",[t._v("HBuilderX 3.6.15以下版本（小程序和web端 WebSocket连接不稳定，请尽快升级）")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("域名")]),t._v(" "),s("th",[t._v("端口")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("wshz.getui.net")]),t._v(" "),s("td",[t._v("5223")])]),t._v(" "),s("tr",[s("td",[t._v("wshz.gepush.com")]),t._v(" "),s("td",[t._v("5223")])])])]),t._v(" "),s("ul",[s("li",[t._v("HBuilderX 3.6.15及以上版本")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("域名")]),t._v(" "),s("th",[t._v("端口")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("wshzn.gepush.com")]),t._v(" "),s("td",[t._v("5223")])]),t._v(" "),s("tr",[s("td",[t._v("wshzn.getui.net")]),t._v(" "),s("td",[t._v("5223（3.8.5新增）")])])])]),t._v(" "),s("h4",{attrs:{id:"listener"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#listener"}},[t._v("#")]),t._v(" 客户端监听推送消息")]),t._v(" "),s("p",[t._v("监听推送消息的代码，需要在收到推送消息之前被执行。所以应当写在应用一启动就会触发的"),s("a",{attrs:{href:"https://uniapp.dcloud.io/collocation/App.html#applifecycle",target:"_blank",rel:"noopener noreferrer"}},[t._v("应用生命周期"),s("OutboundLink")],1),s("code",[t._v("onLaunch")]),t._v("中。")]),t._v(" "),s("p",[t._v("示例代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件路径：项目根目录App.vue/uvue")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onLaunch")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'App Launch'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tuni"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onPushMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"收到推送消息："')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//监听推送消息")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onShow")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'App Show'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onHide")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'App Hide'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("先跟着示例代码简单体验，详细的uni.onPushMessage API介绍：uni-app 框架"),s("RouterLink",{attrs:{to:"/api/plugins/push.html#onpushmessage"}},[t._v("详情参考")]),t._v("，uni-app x 框架"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uni-app-x/api/push.html#onpushmessage",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1)],1)]),t._v(" "),s("p",[s("strong",[t._v("APP端真机运行注意:")])]),t._v(" "),s("ul",[s("li",[t._v("如果启用了离线推送，必须：经过发行原生app云打包后，客户端才能监听到推送消息。标准HBuilder运行基座无法使用。")]),t._v(" "),s("li",[t._v("如果Android应用进入后台后（App未销毁），点击通知消息无法拉起App，请检查设备是否有禁止后台弹出界面，路径>>设置-应用管理-测试应用-权限管理-后台弹出界面，(一般是小米、oppo、\nvivo设备)。")])]),t._v(" "),s("h4",{attrs:{id:"获取客户端推送标识"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取客户端推送标识"}},[t._v("#")]),t._v(" 获取客户端推送标识")]),t._v(" "),s("p",[t._v("假如我要给“张三”打电话，那就需要知道对方的电话标识，即电话号码是多少。\n同理，要给某个客户端推送消息，也需要知道该设备的客户端推送标识。")]),t._v(" "),s("blockquote",[s("p",[t._v("先跟着示例代码简单体验，详细的uni.getPushClientId API介绍：uni-app 框架"),s("RouterLink",{attrs:{to:"/api/plugins/push.html#getpushclientid"}},[t._v("详情参考")]),t._v("，uni-app x 框架"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uni-app-x/api/push.html#getpushclientid",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1),t._v("\n代码示例：")],1)]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// uni-app客户端获取push客户端标记")]),t._v("\nuni"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPushClientId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" push_clientid "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid\n\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'客户端推送标识:'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("push_clientid"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"第四步-服务端推送消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#第四步-服务端推送消息"}},[t._v("#")]),t._v(" 第四步：服务端推送消息")]),t._v(" "),s("p",[t._v("消息推送属于敏感操作，只能直接或间接由服务端触发。传统的三方push服务，需要开发者在服务端配置密钥或证书，根据服务器端文档签名获取token，再向相关URL接口发起网络请求......")]),t._v(" "),s("p",[t._v("而uni-push2.0，开发者无需关心证书、签名、服务器端文档，使用简单。云函数通过 uni-push服务端sdk，即"),s("code",[t._v("uni-cloud-push")]),t._v("的API即可直接执行uni-push所有操作。")]),t._v(" "),s("p",[t._v("uni-push的服务端sdk的体积不小，没有内置在云函数中。在需要操作uni-push的云函数里，开发者需手动配置"),s("code",[t._v("uni-cloud-push")]),t._v("扩展库。\n（uniCloud扩展库，是uniCloud自带API中不常用且包体积较大的部分，被独立为扩展库，可以由开发者自行选择是否使用该扩展库）")]),t._v(" "),s("ul",[s("li",[t._v("HBuilderX 中新建云函数时可选择uni-cloud-push扩展库，或者如下图所示在已有的云函数目录点右键选择“管理公共模块或扩展库依赖”")])]),t._v(" "),s("img",{staticStyle:{width:"80%","max-width":"600px",margin:"0 10%"},attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uniPush-glkzk.jpg",loading:"lazy"}}),t._v(" "),s("img",{staticStyle:{width:"80%","max-width":"450px",margin:"0 10%"},attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/uniPush-kzk.jpg",loading:"lazy"}}),t._v(" "),s("p",[t._v("下面是一个开启了"),s("code",[t._v("uni-cloud-push")]),t._v("扩展库的云函数的package.json示例，"),s("strong",[t._v("注意不可有注释，以下文件内容中的注释仅为说明，如果拷贝此文件，切记去除注释")])]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"version"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"description"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"main"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index.js"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"extensions"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uni-cloud-push"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置为此云函数开启uni-cloud-push扩展库，值为空对象留作后续追加参数，暂无内容")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"author"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("注意：扩展库依赖3张opendb表："),s("code",[t._v("opendb-tempdata")]),t._v(","),s("code",[t._v("opendb-device")]),t._v(","),s("code",[t._v("uni-id-device")]),t._v("。公测版uniCloud，执行扩展库会自动创建。如果你使用的是uniCloud正式版需要自己创建这3张表。")])]),t._v(" "),s("p",[t._v("云函数中调用uni-cloud-push扩展库的"),s("code",[t._v("sendMessage")]),t._v("方法，向客户端推送消息")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 简单的使用示例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'use strict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" uniPush "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" uniCloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPushManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("appId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"__UNI__XXXXXX"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//注意这里需要传入你的应用appId，用于指定接收消息的客户端")]),t._v("\nexports"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("main")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" uniPush"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"push_clientid"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \t"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//填写上一步在uni-app客户端获取到的客户端推送标识push_clientid")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"通知栏显示的标题"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\t\n\t\t"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"content"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"通知栏显示的内容"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"payload"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"text"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"体验一下uni-push2.0"')]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("在云函数文件目录右键（或按快捷键ctrl + r）-> "),s("code",[t._v("运行-本地云函数")]),t._v("，此时你的客户端将收到推送消息（应用关闭时为通知栏消息，在线时代码监听到推送消息）")]),t._v(" "),s("blockquote",[s("p",[t._v("先跟着示例代码简单体验一下，详细的uniPush.sendMessage API介绍"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/uni-cloud-push/api.html#uni-cloud-push",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("如果按步骤操作完毕，此时你运行起来的uni-app客户端就会打印出“收到推送消息：xxxx”。如遇异常，可以重新运行一遍。")]),t._v(" "),s("h2",{attrs:{id:"最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#最佳实践"}},[t._v("#")]),t._v(" 最佳实践")]),t._v(" "),s("p",[t._v("上一节，演示了基于“客户端推送标识”的消息推送，仅为方便理解和体验；在业务开发中，通常是指定消息的接收人，而不是某个设备。")]),t._v(" "),s("p",[t._v("如果项目使用"),s("a",{attrs:{href:"https://ext.dcloud.net.cn/plugin?id=8577",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-id-pages"),s("OutboundLink")],1),t._v("或 "),s("a",{attrs:{href:"https://ext.dcloud.net.cn/plugin?name=uni-id-pages-x",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-id-pages-x"),s("OutboundLink")],1),t._v("，即可直接指定基于uni-id的user_id、user_tag，并可筛选设备的平台、登录信息是否有效等，执行推送消息。")]),t._v(" "),s("p",[t._v("uni-id-pages/uni-id-pages-x 已经内置了：在登录账号、退出账号、切换账号、token续期、注销账号5个时机，管理uni-id-device表、opendb-device表与user_id、push_clientid、platform、os_name等字段的映射关系。"),s("a",{attrs:{href:"https://doc.dcloud.net.cn/uniCloud/uni-cloud-push/mate.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("详情参考"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),s("p",[t._v("以上内置逻辑，在uni-id-pages下，会自动判断是否启用push模块自动执行；但uni-id-pages-x下，需手动在:"),s("code",[t._v("/uni_modules/uni-id-pages-x/init.uts")]),t._v("导入 autoReportPushClientId 模块。")])]),t._v(" "),s("p",[t._v("此外"),s("code",[t._v("uni-push 2.0")]),t._v(" 还提供了uni-admin中的web控制台"),s("a",{attrs:{href:"https://ext.dcloud.net.cn/plugin?name=uni-push-admin",target:"_blank",rel:"noopener noreferrer"}},[t._v("uni-push-admin"),s("OutboundLink")],1),t._v("。包含消息推送、推送统计等功能，而且是开源的，可自定义。如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/f981f620-f9de-11ec-8412-6b7a68f609ab_0.jpg",alt:"",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"常见问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/unipush.html#faq"}},[t._v("参考文档")])],1),t._v(" "),s("p",[s("strong",[t._v("使用有其他疑问")]),t._v("，欢迎扫码加入 uni-push2.0 微信交流群讨论：\n"),s("br"),s("img",{attrs:{src:"https://qiniu-web-assets.dcloud.net.cn/unidoc/zh/support.jpg",width:"250",loading:"lazy"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);