(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{530:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"package-json"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#package-json"}},[t._v("#")]),t._v(" package.json")]),t._v(" "),s("h2",{attrs:{id:"uni-app-属性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uni-app-属性"}},[t._v("#")]),t._v(" uni-app 属性")]),t._v(" "),s("ul",[s("li",[t._v("在开发web时，有时需要一套代码编译发布到不同的站点，比如主站和微信h5站。（注意不是一套代码内部自适应不同浏览器，是真的分离部署了不同的网站）")]),t._v(" "),s("li",[t._v("在开发小程序时，经常有扩展小程序平台，比如基于阿里小程序的钉钉小程序、淘宝小程序。")])]),t._v(" "),s("p",[t._v("uni-app 通过在"),s("code",[t._v("package.json")]),t._v("文件中增加"),s("code",[t._v("uni-app")]),t._v("扩展节点，可实现自定义条件编译平台。")]),t._v(" "),s("p",[t._v("扩展新的平台后，有3点影响：")]),t._v(" "),s("ol",[s("li",[t._v("可以在代码里编写自定义的条件编译，为这个新平台编写专用代码")]),t._v(" "),s("li",[t._v("运行时可以执行面向新平台的编译运行")]),t._v(" "),s("li",[t._v("发行时可以执行面向新平台的编译发行")])]),t._v(" "),s("p",[t._v("注意只能扩展web和小程序平台，不能扩展app打包。并且扩展小程序平台时只能基于指定的基准平台扩展子平台，不能扩展基准平台。基准平台详见下文。")]),t._v(" "),s("h3",{attrs:{id:"用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),s("p",[t._v("package.json扩展配置用法：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * package.json其它原有配置 \n     * 拷贝代码后请去掉注释！\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uni-app"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 扩展配置")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"custom-platform"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自定义编译平台配置，可通过cli方式调用")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"自定义扩展名称"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在HBuilderX中会显示在 运行/发行 菜单中")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"browser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//运行到的目标浏览器，仅当UNI_PLATFORM为h5时有效")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//环境变量")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"UNI_PLATFORM"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//基准平台")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MY_TEST"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 其他自定义环境变量")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"define"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自定义条件编译")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"CUSTOM-CONST"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//自定义条件编译常量，建议为大写")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Tips：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("UNI_PLATFORM")]),t._v(" 仅支持填写 "),s("code",[t._v("uni-app")]),t._v(" 默认支持的基准平台，目前仅限如下枚举值："),s("code",[t._v("h5")]),t._v("、"),s("code",[t._v("mp-weixin")]),t._v("、"),s("code",[t._v("mp-alipay")]),t._v("、"),s("code",[t._v("mp-baidu")]),t._v("、"),s("code",[t._v("mp-toutiao")]),t._v("、"),s("code",[t._v("mp-qq")])]),t._v(" "),s("li",[s("code",[t._v("browser")]),t._v(" 仅在 "),s("code",[t._v("UNI_PLATFORM")]),t._v(" 为 "),s("code",[t._v("h5")]),t._v(" 时有效,目前仅限如下枚举值："),s("code",[t._v("chrome")]),t._v("、"),s("code",[t._v("firefox")]),t._v("、"),s("code",[t._v("ie")]),t._v("、"),s("code",[t._v("edge")]),t._v("、"),s("code",[t._v("safari")]),t._v("、"),s("code",[t._v("hbuilderx")])]),t._v(" "),s("li",[s("code",[t._v("package.json")]),t._v(" 文件中不允许出现注释，否则扩展配置无效")]),t._v(" "),s("li",[s("code",[t._v("vue-cli")]),t._v(" 需更新到最新版，HBuilderX需升级到 2.1.6+ 版本")]),t._v(" "),s("li",[s("code",[t._v("vue2")]),t._v(" 可以通过 "),s("code",[t._v("process.UNI_SCRIPT_ENV")]),t._v(" 获取对应平台配置的 "),s("code",[t._v("env")]),t._v("，"),s("code",[t._v("vue3")]),t._v(" 可以通过 "),s("code",[t._v("process.env.UNI_CUSTOM_DEFINE")]),t._v(" 获取")])]),t._v(" "),s("h3",{attrs:{id:"示例-钉钉小程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例-钉钉小程序"}},[t._v("#")]),t._v(" 示例：钉钉小程序")]),t._v(" "),s("p",[t._v("如下是一个自定义钉钉小程序（MP-DINGTALK）的package.json示例配置（拷贝代码记得去掉注释）：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uni-app"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"mp-dingtalk"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"钉钉小程序"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"UNI_PLATFORM"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mp-alipay"')]),t._v(" \n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"define"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n\t\t\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"MP-DINGTALK"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" \n\t\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("在代码中使用自定义平台")])]),t._v(" "),s("p",[t._v("开发者可在代码中使用"),s("code",[t._v("MP-DINGTALK")]),t._v("进行条件编译，如下：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef MP")]),t._v("\n小程序平台通用代码（含钉钉）\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef MP-ALIPAY")]),t._v("\n支付宝平台通用代码（含钉钉）\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef MP-DINGTALK")]),t._v("\n钉钉平台特有代码\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n")])])]),s("p",[s("strong",[t._v("运行及发布项目")])]),t._v(" "),s("p",[s("code",[t._v("vue-cli")]),t._v("开发者可通过如下命令，启动钉钉小程序平台的编译：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run dev:custom mp-dingtalk \n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build:custom mp-dingtalk\n")])])]),s("p",[s("code",[t._v("HBuilderX")]),t._v("会根据"),s("code",[t._v("package.json")]),t._v("的扩展配置，在"),s("code",[t._v("运行")]),t._v("、"),s("code",[t._v("发行")]),t._v("菜单下，生成自定义菜单（钉钉小程序），开发者点击对应菜单编译运行即可，如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/package-dingding.png",alt:"package dingding"}})]),t._v(" "),s("p",[t._v("Tips：钉钉小程序编译目录依然是"),s("code",[t._v("mp-alipay")]),t._v("，需通过支付宝开发者工具，选择“钉钉小程序”，然后打开该目录进行预览及发布。")]),t._v(" "),s("h3",{attrs:{id:"示例-微信服务号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例-微信服务号"}},[t._v("#")]),t._v(" 示例：微信服务号")]),t._v(" "),s("p",[t._v("如下是一个自定义微信服务号平台（H5-WEIXIN）的示例配置：")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uni-app"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"h5-weixin"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"title"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"微信服务号"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"browser"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chrome"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"env"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"UNI_PLATFORM"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h5"')]),t._v("  \n             "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"define"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n                "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"H5-WEIXIN"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("开发者可在代码块中使用"),s("code",[t._v("H5-WEIXIN")]),t._v("变量，如下：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef H5")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("H5")]),t._v("平台通用代码（含微信服务号）\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #ifdef H5-WEIXIN")]),t._v("\n微信服务号特有代码\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// #endif")]),t._v("\n")])])]),s("p",[s("code",[t._v("vue-cli")]),t._v("开发者可通过如下命令，启动微信服务号平台（H5-WEIXIN）平台的编译：")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run dev:custom h5-weixin \n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run build:custom h5-weixin\n")])])]),s("p",[s("code",[t._v("HBuilderX")]),t._v("会根据"),s("code",[t._v("package.json")]),t._v("的扩展配置，在"),s("code",[t._v("运行")]),t._v("、"),s("code",[t._v("发行")]),t._v("菜单下，生成自定义菜单（微信服务号），开发者点击对应菜单编译运行即可，如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/package-h5-weixin.png",alt:""}})])])}),[],!1,null,null,null);s.default=e.exports}}]);