(window.webpackJsonp=window.webpackJsonp||[]).push([[338],{723:function(e,t,a){"use strict";a.r(t);var s=a(1),v=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("p",[e._v("iOS有UIWebview和WKWebview两种webview。从iOS13开始苹果将UIWebview列为过期API。")]),e._v(" "),t("p",[t("strong",[e._v("2020年4月起App Store将不再接受使用UIWebView的新App上架、2020年12月起将不再接受使用UIWebView的App更新。")])]),e._v(" "),t("p",[e._v("从HBuilderX 2.2.5起，iOS上默认均已经是WKWebview，除非开发者手动在代码中指定要用UIWebview，否则实际渲染的页面都是在WKWebview里渲染的。\n不过，虽然实际页面是WKWebview渲染的，但App底层引擎源码里仍然有UIWebview的可选引用。Appstore的机审会发现二进制代码中包括对UIWebview的引用，从而引发告警。\n从HBuilderX 2.6.6起，uiWebview从基础引擎中移除，变成可选模块（manifest里选择）。机审也没有提示了。")]),e._v(" "),t("p",[e._v("老HBuilder和HBuilderX 2.2.5之前的版本，App端策略如下：")]),e._v(" "),t("ul",[t("li",[e._v("5+ APP（含wap2app）\n默认为UIWebview。")]),e._v(" "),t("li",[e._v("uni-app\nvue页面中web-view组件默认使用UIWebview，nvue页面中web-view组件使用WKWebview。")])]),e._v(" "),t("p",[t("strong",[e._v("HBuilderX 2.2.5+版本已将iOS上所有webview的默认内核由UIWebview调整为WKWebview。")])]),e._v(" "),t("a",{attrs:{id:"uiwebview"}}),e._v(" "),t("p",[t("strong",[e._v("HBuilderX 2.6.6+版本已将iOS中所有UIWebview代码从基础引擎中摘除，独立为UIWebview模块，如继续使用UIWebview则需在manifest中勾选使用UIWebview模块")])]),e._v(" "),t("h3",{attrs:{id:"配置使用uiwebview模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置使用uiwebview模块"}},[e._v("#")]),e._v(" 配置使用UIWebview模块")]),e._v(" "),t("p",[e._v("打开项目的manifest.json文件，在“App模块配置”中勾选“iOS UIWebview”：\n"),t("img",{attrs:{src:"/images/uiwebview-manifest.png",alt:""}})]),e._v(" "),t("p",[t("strong",[e._v("提示")])]),e._v(" "),t("blockquote",[t("p",[e._v("使用UIWebview模块提交云端打包后才能生效，真机运行调试时请使用"),t("a",{attrs:{href:"http://ask.dcloud.net.cn/article/35115",target:"_blank",rel:"noopener noreferrer"}},[e._v("自定义基座"),t("OutboundLink")],1),t("br"),e._v("\n使用UIWebview模块后应用无法通过App Store审核"),t("br"),e._v("\n本地离线打包请参考："),t("a",{attrs:{href:"https://nativesupport.dcloud.net.cn/AppDocs/usemodule/iOSModuleConfig/uiwebview",target:"_blank",rel:"noopener noreferrer"}},[e._v("配置UIWebview模块"),t("OutboundLink")],1)])]),e._v(" "),t("h3",{attrs:{id:"使用uiwebview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用uiwebview"}},[e._v("#")]),e._v(" 使用UIWebview")]),e._v(" "),t("h4",{attrs:{id:"_5-app-含wap2app-如何切换ios默认使用uiwebview或wkwebview内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-app-含wap2app-如何切换ios默认使用uiwebview或wkwebview内核"}},[e._v("#")]),e._v(" 5+App（含wap2app）如何切换iOS默认使用UIWebview或WKWebview内核？")]),e._v(" "),t("p",[e._v('HBuilderX 2.2.5以前的版本，iOS上webview的默认为UIWebview，HBuilderX2.2.5及以后的版本默认改为WKWebview。\n如果要修改默认值，可在manifest.json中配置。\n在manifest.json文件源码视图中设置plus -> kernel -> ios 的值为 "WKWebview"或"UIWebview"：')]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"plus"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"kernel"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ios"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"UIWebview"')]),e._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v('//或者 "WKWebview"')]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ...")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("h4",{attrs:{id:"uni-app-如何配置web-view组件默认使用uiwebview或wkwebview内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uni-app-如何配置web-view组件默认使用uiwebview或wkwebview内核"}},[e._v("#")]),e._v(" uni-app 如何配置web-view组件默认使用UIWebview或WKWebview内核？")]),e._v(" "),t("p",[e._v('HBuilderX 2.2.5以前的版本，iOS上vue页面中web-view组件或调用5+ API创建的Webview窗口默认为UIWebview，HBuilderX2.2.5及以后的版本默认改为WKWebview。\n如果要修改默认值，可在manifest.json中配置。\n在manifest.json文件源码视图中设置 app-plus -> kernel -> ios 的值为 "WKWebview"或"UIWebview"：')]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[e._v("\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"app-plus"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"kernel"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"ios"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"UIWebview"')]),e._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v('//或者 "WKWebview"')]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// ...")]),e._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[t("strong",[e._v("nvue页面中的web-view组件强制使用WKWebview，不可配置")])]),e._v(" "),t("h4",{attrs:{id:"如何使用5-api-plus-webview-create-创建webview窗口时指定使用uiwebview或wkwebview内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何使用5-api-plus-webview-create-创建webview窗口时指定使用uiwebview或wkwebview内核"}},[e._v("#")]),e._v(" 如何使用5+ API（plus.webview.create）创建Webview窗口时指定使用UIWebview或WKWebview内核？")]),e._v(" "),t("p",[e._v("创建Webvie窗口时可通过kernel属性指定内核，如下：")]),e._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 通过kernel属性指定Webview的内核")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" w "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" plus"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("webview"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'https://xxx.xxx.xxx'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[e._v("'kernel'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'UIWebview'")]),e._v("       "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//或者'WKWebview'")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),t("p",[e._v("更多规范参考5+ API的 "),t("a",{attrs:{href:"https://www.html5plus.org/doc/zh_cn/webview.html#plus.webview.WebviewStyles",target:"_blank",rel:"noopener noreferrer"}},[e._v("WebviewStyles"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"使用wkwebview的影响"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用wkwebview的影响"}},[e._v("#")]),e._v(" 使用WKWebview的影响")]),e._v(" "),t("p",[t("strong",[e._v("使用WKWebview替换UIWebview将会影响以下功能：")])]),e._v(" "),t("ul",[t("li",[e._v("更严格的跨域访问限制\nWKWebview认为本地html通过js访问网络及本地文件都算跨域访问（这种情况UIWebview不是跨域），跨域时访问网络资源使用5+ API（plus.net）来替换xmlhttp等传统ajax写法；ajax也不能访问本地文件，需使用5+ API（plus.io）读取本地文件，后者有个单独文章可参考："),t("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36858",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ask.dcloud.net.cn/article/36858"),t("OutboundLink")],1),e._v("。\n使用exif.js等三方库可能涉及跨目录的本地图片下载请求，图像方向获取和旋转Plus有专门的API，无需使用js库做。")]),e._v(" "),t("li",[e._v("由于WKWebview不支持跨域访问，标准的xhr或jq的ajax，都无法跨域。mui框架中网络请求判断为跨域访问会自动调用5+ API（plus.net），如果在mui.plusReady触发前调用，因为5+ API没有准备好会报“Script error.filename:lineno:0”错误，这时必须保证mui的网络请求在mui.plusReady后调用，或者直接改用plus.net写法。")]),e._v(" "),t("li",[e._v("WKWebview下canvas也有跨域问题，比如canvas.toDataURL。\n如果canvas使用网络图像遇到跨域问题，需要服务端设置图像的响应头：Access-Control-Allow-Origin\n如果canvas使用本地图像遇到跨域问题，可以使用plus接口将图像转换为base64再使用，相关插件：https://ext.dcloud.net.cn/plugin?id=123")]),e._v(" "),t("li",[e._v("iOS手机内存不足时，如果是UIWebview的应用，系统会整体回收这个App，现象是在重新打开已打开过的App时App整体重启。而WKWebview则是单个页面回收，这带来的坏处就是内存不足时，会单个页面白屏。详见"),t("a",{attrs:{href:"https://ask.dcloud.net.cn/article/35913",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ask.dcloud.net.cn/article/35913"),t("OutboundLink")],1),e._v("。uni-app不涉及此问题，如果是5+App，方式1是在manifest切回UIWebview，暂时UIWebview还可以上架，只是会收到警告。方式2时监听白屏事件，自行恢复页面："),t("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36540",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ask.dcloud.net.cn/article/36540"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("iOS8、9上的WKWebview不支持websql，iOS10恢复支持")]),e._v(" "),t("li",[e._v("不支持plus.navigator.setCookie")]),e._v(" "),t("li",[e._v("不支持webview的overrideresource方法")]),e._v(" "),t("li",[e._v("wk第一次渲染速度略慢于uiwebview；")]),e._v(" "),t("li",[e._v("由于资源拦截的API overrideresource 无法再使用，5+ APP（含wap2app）项目中，云打包时的js原生混淆功能会失效。如果要使用js原生混淆必须使用UIWebview。uni-app有单独的原生js加密方案，因为uni-app的js不运行在webview里，而是在独立的jscore里，所以不受影响。")])]),e._v(" "),t("p",[e._v("但WKWebview的好处是：节省内存；滚动时懒加载的图片也可以实时渲染，而uiwebview在滚动停止后懒加载的图片才能显示。")]),e._v(" "),t("p",[e._v("如果同时在一个app里使用ui和wk两种webview，注意2种webview之间的cookie、localstorage、session不共享，但plus.storage是共享的。")]),e._v(" "),t("h3",{attrs:{id:"uni-app中webview的使用注意"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uni-app中webview的使用注意"}},[e._v("#")]),e._v(" uni-app中Webview的使用注意")]),e._v(" "),t("p",[e._v("uni-app的js运行在独立的jscore中，而不是Webview中，不存在跨域问题。\nuni-app的渲染层，在iOS下是强制wkwebview。如果你编写了renderjs代码，在渲染层执行js，则同样会遇到跨域问题。此时尽量把与跨域相关的操作放到普通的js逻辑层操作。\n除了渲染层，还有一个web-view组件的问题要注意：")]),e._v(" "),t("ul",[t("li",[e._v("uni-app的vue页面的web-view组件，从HBuilderX 2.2.5+起是WKWebview，之前版本默认是UIWebview")]),e._v(" "),t("li",[e._v("uni-app的非自定义组件模式的js逻辑层，在HBuilderX 2.2.5之前是UIWebview。升级到HBuilderX2.3+后可能导致网络跨域问题，"),t("code",[e._v('fail{"statusCode":0,"errMsg":"request:fail abort"}')]),e._v("。不过非自定义组件已于2019年11月1日起停止支持。")])]),e._v(" "),t("p",[e._v("如果需要调整uni-app下web-view组件的渲染内核设置，将manifest.json源码视图的app-plus -> kernel -> ios 的值设为 UIWebview。")]),e._v(" "),t("h4",{attrs:{id:"uni-app的nvue页面问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#uni-app的nvue页面问题"}},[e._v("#")]),e._v(" uni-app的nvue页面问题")]),e._v(" "),t("p",[e._v("nvue页面不使用webview渲染，但其中的web-view组件说明如下。")]),e._v(" "),t("ul",[t("li",[e._v("nvue的weex 组件模式\nweex模式下的web-view组件是weex自己实现的，它目前仍然使用UIWebview。官方会追踪weex的升级。")]),e._v(" "),t("li",[e._v("nvue的uni-app组件模式\nweb-view组件使用WKWebview。不可修改为uiWebview。")])]),e._v(" "),t("h3",{attrs:{id:"三方sdk中uiwebview的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#三方sdk中uiwebview的使用"}},[e._v("#")]),e._v(" 三方SDK中UIWebview的使用")]),e._v(" "),t("p",[e._v("目前如下SDK中仍然使用了UIWebview，不管是5+App还是uni-app。")]),e._v(" "),t("ul",[t("li",[e._v("DCloud开屏广告\nHBuilderX 2.2.5版之前，点击广告打开的内置网页仍然使用UIWebview加载\nHBuilderX 2.2.5+版本已调整改为WKWebview。")]),e._v(" "),t("li",[e._v("支付宝\nHBuilderX 2.6.10版本之前，支付宝SDK为15.5.7版本，包含了UIWebview\nHBuilderX 2.6.10+版本已更新支付宝SDK为15.7.4，没有使用UIWebview")]),e._v(" "),t("li",[e._v("微信登录、分享、支付\nHBuilderX 2.6.6+版本已更新微信SDK为1.8.6.2版本，没有使用UIWebview。\n注意微信登录支付的SDK升级后，会强制要求通用链接。另见文档："),t("a",{attrs:{href:"https://ask.dcloud.net.cn/article/36445",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://ask.dcloud.net.cn/article/36445"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("微博登录、分享\nHBuilderX 2.6.10版本之前，微博SDK为3.2.5版本，包含了UIWebview\nHBuilderX 2.6.10+版本已更新微博SDK为3.2.7版本，没有使用UIWebview")]),e._v(" "),t("li",[e._v("QQ登录、分享\nHBuilderX 2.3.4+版本已更新QQSDK为3.3.6，没有使用UIWebview。")]),e._v(" "),t("li",[e._v("小米登录\n小米官方SDK中使用了UIWebview，如果提交appstore建议不要使用小米登录")])]),e._v(" "),t("p",[t("strong",[e._v("5+App开发者建议直接升级为uni-app，一劳永逸，不会有跨域、白屏和无法加密等各种问题。")])]),e._v(" "),t("h3",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[e._v("#")]),e._v(" 注意事项")]),e._v(" "),t("p",[e._v("如果没有配置使用“iOS UIWebview”模块，提交App Store，仍然被提示含有UIWebview，那么请检查你的app是否使用了其他原生插件。\n一般或者是配置错误，或者是三方原生插件造成。、")])])}),[],!1,null,null,null);t.default=v.exports}}]);