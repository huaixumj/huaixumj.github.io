(window.webpackJsonp=window.webpackJsonp||[]).push([[410],{792:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"uni-app-runtime使用说明-内部简易教程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#uni-app-runtime使用说明-内部简易教程"}},[t._v("#")]),t._v(" uni-app-runtime使用说明（内部简易教程）")]),t._v(" "),s("h2",{attrs:{id:"配置鸿蒙原生项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置鸿蒙原生项目"}},[t._v("#")]),t._v(" 配置鸿蒙原生项目")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("创建一个空的鸿蒙项目")])]),t._v(" "),s("li",[s("p",[t._v("修改鸿蒙项目根目录文件 "),s("code",[t._v("oh-package.json5")]),t._v(" 的依赖 "),s("code",[t._v('"@dcloudio/uni-app-runtime": "版本号"')]),t._v("，如下图所示")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/6ed02769-bbf1-46a9-aae5-80cebc86ba82.png",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("点击右上角 Sync Now，并等待 Sync 结束")])]),t._v(" "),s("li",[s("p",[t._v("打开鸿蒙项目文件 "),s("code",[t._v("/entry/src/main/ets/entryability/EntryAbility.ets")]),t._v("，增加uni-app sdk初始化逻辑。这里引用了一个"),s("code",[t._v("distribute.json")]),t._v("文件，后续步骤中会讲解如何配置此文件。")])])]),t._v(" "),s("div",{staticClass:"language-ts extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ts"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" UniEntryAbility"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" uni "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@dcloudio/uni-app-runtime'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" initUniModules "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../uni_modules/index.generated'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BuildProfile "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BuildProfile'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" distribute "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./distribute.json'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initUniModules")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EntryAbility")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UniEntryAbility")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HBuilder'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      debug"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" BuildProfile"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEBUG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      distribute\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"集成编译产物到项目内"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#集成编译产物到项目内"}},[t._v("#")]),t._v(" 集成编译产物到项目内")]),t._v(" "),s("ol",[s("li",[t._v("将uni_modules入口文件移动到"),s("code",[t._v("/entry/src/main/ets/uni_modules/index.generated.ets")]),t._v(", 如果目录不存在则需要手动创建")])]),t._v(" "),s("p",[t._v("移动"),s("code",[t._v("dist/dev/app-harmony/uni_modules_packages/index.generated.ets")]),t._v("文件到鸿蒙项目"),s("code",[t._v("/entry/src/main/ets/uni_modules/index.generated.ets")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/20240904152004.jpg",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("将uni_modules文件部署到鸿蒙工程内")])]),t._v(" "),s("p",[t._v("移动"),s("code",[t._v("dist/dev/app-harmony/uni_modules_packages")]),t._v("目录下的模块目录到鸿蒙项目"),s("code",[t._v("/uni_modules")]),t._v("目录")]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/20240914143945.jpg",alt:""}})]),t._v(" "),s("p",[t._v("编译到鸿蒙时每个uts api的uni_module都会创建一个鸿蒙的静态库。对于静态库有两个概念需要区分一下。")]),t._v(" "),s("ul",[s("li",[t._v("静态库的module名称（如下称为moduleName），每个静态库的名称，只允许大小写字母加下划线组成")]),t._v(" "),s("li",[t._v("静态库的包名（如下称为packageName），静态库被import时的名称，类似npm包名")])]),t._v(" "),s("p",[t._v("对于一个名称为uni-getBatteryInfo的uni_module，它的moduleName为"),s("code",[t._v("uni_modules__uni_getBatteryInfo")]),t._v("，packageName为"),s("code",[t._v("@uni_modules/uni-getBatteryInfo")]),t._v("。")]),t._v(" "),s("p",[t._v("packageName规则较为简单，给uni_module名称前加上"),s("code",[t._v("@uni_modules")]),t._v("前缀即可")]),t._v(" "),s("p",[t._v("moduleName是在packageName的基础上生成的，移除@符号，将/替换为两个下划线，将-替换为一个下划线")]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("修改鸿蒙项目"),s("code",[t._v("oh-package.json5")])])]),t._v(" "),s("p",[t._v("为所有uni_module注册packageName。")]),t._v(" "),s("p",[t._v("以uni-getBatteryInfo为例，在"),s("code",[t._v("oh-package.json5")]),t._v("文件内"),s("code",[t._v("dependencies")]),t._v("字段下添加如下内容")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"@uni_modules/uni-getBatteryInfo"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./uni_modules/uni-getBatteryInfo"')]),t._v("\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("修改鸿蒙项目"),s("code",[t._v("build-profile.json5")])])]),t._v(" "),s("p",[t._v("为所有uni_module注册moduleName。")]),t._v(" "),s("p",[t._v("以uni-getBatteryInfo为例，在"),s("code",[t._v("build-profile.json5")]),t._v("文件内"),s("code",[t._v("modules")]),t._v("数组内添加如下内容")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"uni_modules__uni_getBatteryInfo"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"srcPath"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./uni_modules/uni-getBatteryInfo"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("将生成资源内的"),s("code",[t._v("dist/dev/app-harmony/manifest.json")]),t._v("的distribute节点移动到鸿蒙项目"),s("code",[t._v("/entry/src/main/ets/entryability/distribute.json")]),t._v("内。与鸿蒙无关的信息可自行移除")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/20240914143236.jpg",alt:""}})]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[t._v("将小程序打包出的资源（cli项目使用npm run build:app-harmony生成）拷贝到"),s("code",[t._v("/entry/src/main/resources/resfile/apps/HBuilder")]),t._v("目录（"),s("strong",[t._v("注意是resfile不是rawfile")]),t._v("）。")])]),t._v(" "),s("p",[s("img",{attrs:{src:"/images/20240914143649.jpg",alt:""}})])])}),[],!1,null,null,null);s.default=n.exports}}]);